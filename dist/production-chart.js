"use strict";(function(){Polymer({is:"production-chart",listeners:{"legend-actual.tap":"_toggleActual","legend-target.tap":"_toggleTarget","legend-forecast.tap":"_toggleForecast"},properties:{width:{type:Number,value:960},height:{type:Number,value:300},chartType:{type:String,value:"line"},axisConfig:{type:Object,value:function value(){return{"x":{"tickFormat":"","inputTimeFormat":"%Y-%m-%dT%H:%M:%S.%LZ","tickTimeFormat":"%d %b %y","todayLabel":"Today","historicalLabel":"Historical","forecastLabel":"Forecast"},"y":{"tickFormat":".3s","hideGrid":true,"dotRadius":0,"start":0,"series":{"design":{"color":"rgba(237, 221, 70, 0.7)","dashArray":"2,2"},"actual":{"color":"#5fbcf8"},"target":{"color":"#f05c56"},"forecast":{"color":"rgba(164, 117, 237, 0.8)"}}}}}},actualDispVal:{type:Number},targetDispVal:{type:Number},designDispVal:{type:Number},forecastDispVal:{type:Number},actualLegendLabel:{type:String},targetLegendLabel:{type:String},forecastLegendLabel:{type:String},designCapacityLegendLabel:{type:String},hideActualLegend:{type:Boolean,value:false},hideTargetLegend:{type:Boolean,value:false},hideForecastLegend:{type:Boolean,value:false},hideDesignCapacityLegend:{type:Boolean,value:false},legendLabels:{type:Array,value:function value(){return[]},observer:"_setLegendLabels"},unit:{type:String,value:"Metric Ton/day"},axisKeys:{type:Array,value:function value(){return["actual","target","forecast","design"]}},data:{type:Array,value:function value(){return[]},observer:"_redraw"},dateRange:{type:Object,notify:true,value:function value(){return{}}},datePicker:{type:String,value:""}},ready:function ready(){this.scopeSubtree(this.$.chart,true)},isDatePickerBased:function isDatePickerBased(datePicker){return datePicker?true:false},isDateRangeBased:function isDateRangeBased(datePicker){return datePicker?false:true},attached:function attached(){},draw:function draw(){var _this=this;var d3=Px.d3;var me=this;var data=this.data;// set the dimensions and margins of the graph
var margin={top:20,right:20,bottom:30,left:50},width=this.width-margin.left-margin.right,height=this.height-margin.top-margin.bottom;this.axisConfig=this.axisConfig||{};this.axisConfig.x=this.axisConfig.x||{};this.axisConfig.y=this.axisConfig.y||{};this.axisConfig.y.series=this.axisConfig.y.series||{};this.axisConfig.y.series.design=this.axisConfig.y.series.design||{};this.axisConfig.y.series.design.color=this.axisConfig.y.series.design.color||"rgba(237, 221, 70, 0.7)";this.axisConfig.y.series.actual=this.axisConfig.y.series.actual||{};this.axisConfig.y.series.actual.color=this.axisConfig.y.series.actual.color||"#5fbcf8";this.axisConfig.y.series.target=this.axisConfig.y.series.target||{};this.axisConfig.y.series.target.color=this.axisConfig.y.series.target.color||"#f05c56";this.axisConfig.y.series.forecast=this.axisConfig.y.series.forecast||{};this.axisConfig.y.series.forecast.color=this.axisConfig.y.series.forecast.color||"rgba(164, 117, 237, 0.8)";this.actualCol=this.axisConfig.y.series.actual.color;this.targetCol=this.axisConfig.y.series.target.color;this.forecastCol=this.axisConfig.y.series.forecast.color;this.designCol=this.axisConfig.y.series.design.color;this.chartType=this.chartType||"line";var defaultDotRadius=this.axisConfig.y.dotRadius;if(!defaultDotRadius){if(defaultDotRadius!=0){defaultDotRadius=2}else{defaultDotRadius=0}}defaultDotRadius=+defaultDotRadius;// parse the date / time
var inTimeFormat=this.axisConfig.x.inputTimeFormat?this.axisConfig.x.inputTimeFormat:"%Y-%m-%dT%H:%M:%S.%LZ";var parseTime=d3.timeParse(inTimeFormat);var tooltipTimeFormat=d3.timeFormat("%A, %b %d");var tooltipTimeFormat2=d3.timeFormat("%Y");// set the ranges
var x=d3.scaleTime().range([0,width]);var y=d3.scaleLinear().range([height,0]).clamp(true);var actualArea=d3.area().x(function(d){return x(d.date)}).y(function(d){return y(d[me.axisKeys[0]])});var actualLine=d3.line().x(function(d){return x(d.date)}).y(function(d){return y(d[me.axisKeys[0]])});var targetChart=d3.line().x(function(d){return x(d.date)}).y(function(d){return y(d[me.axisKeys[1]])});var forecastLine=d3.line().x(function(d){return x(d.date)}).y(function(d){return y(d[me.axisKeys[2]])});var area=d3.area().x(function(d){return x(d.date)}).y1(function(d){return y(d[me.axisKeys[3]])});var designLine=d3.line().x(function(d){return x(d.date)}).y(function(d){return y(d[me.axisKeys[3]])});var svg=d3.select(this.$.chart).append("svg")// .attr("width", width + margin.left + margin.right)
// .attr("height", height + margin.top + margin.bottom)
.attr("viewBox","0 0 "+this.width+" "+this.height).attr("preserveAspectRatio","xMidYMid meet").append("g").attr("transform","translate("+margin.left+","+margin.top+")");data.forEach(function(d){d.date=d.date.getTime?d.date:parseTime(d.date);me.axisKeys.forEach(function(key){d[key]=d[key]?+d[key]:0})});var today=void 0;var yMax=d3.max(data,function(d){return Math.max(d.actual,d.target,d.forecast,d.design)});var yMin=this.axisConfig.y.start;if(!yMin){if(yMin!=0){yMin=yMax/2}}yMin=+yMin;x.domain(d3.extent(data,function(d){return d.date})).nice(d3.timeDay);y.domain([yMin,yMax]).nice(6);var yScaledMin=y(y.domain()[0]);actualArea.y1(yScaledMin);area.y0(yScaledMin);var toolTip=d3.tip(d3.select(this.$.chart)).attr("class","d3-tip").offset([-8,0]).html(function(d){return d.msg});svg.call(toolTip);var actualData=[],designData=[],forecastData=[],targetData=[];var todayActual=0,todayTarget=0,todayForecast=0,todayDesign=0;data.forEach(function(_data){if(_data.actual==_data.forecast){today=_data.date;_this.designDispVal=_data.design.toFixed(0);_this.actualDispVal=_data.actual.toFixed(0);_this.targetDispVal=_data.target.toFixed(0);_this.forecastDispVal=_data.forecast.toFixed(0);todayActual=_this.actualDispVal;todayTarget=_this.targetDispVal;todayForecast=_this.forecastDispVal;todayDesign=_this.designDispVal}if(_data.actual>0){actualData.push(_data)}if(_data.target>0){targetData.push(_data)}if(_data.forecast>0){forecastData.push(_data)}if(_data.design>0){designData.push(_data)}});if(!todayActual&&!todayTarget&&!todayForecast&&!todayDesign){var lastObj=data[data.length-1];todayActual=lastObj.actualDispVal?lastObj.actualDispVal.toFixed(0):"";todayTarget=lastObj.targetDispVal?lastObj.targetDispVal.toFixed(0):"";todayForecast=lastObj.forecastDispVal?lastObj.targetDispVal.toFixed(0):"";todayDesign=lastObj.designDispVal?lastObj.targetDispVal.toFixed(0):""}if(!today){today=new Date}this.set("hideActualLegend",actualData.length===0);this.set("hideTargetLegend",targetData.length===0);this.set("hideForecastLegend",forecastData.length===0);this.set("hideDesignCapacityLegend",designData.length===0);var updateLegendVal=function updateLegendVal(d){_this.actualDispVal=d.actual.toFixed(0);_this.targetDispVal=d.target.toFixed(0);_this.forecastDispVal=d.forecast.toFixed(0);_this.designDispVal=d.design.toFixed(0)};var revertLegendValToToday=function revertLegendValToToday(){_this.actualDispVal=todayActual;_this.targetDispVal=todayTarget;_this.forecastDispVal=todayForecast;_this.designDispVal=todayDesign};if(designData.length){if(this.chartType==="line"){svg.append("path").data([designData]).attr("class","design-line").style("stroke",this.axisConfig.y.series.design.color).style("stroke-dasharray",this.axisConfig.y.series.design.dashArray||"0,0").style("fill","transparent").attr("d",designLine).style("pointer-events","none")}else{svg.append("path").datum(designData).attr("fill",this.axisConfig.y.series.design.color).attr("d",area).style("pointer-events","none")}svg.selectAll(".dot").data(designData).enter().append("circle").attr("r",0).attr("cx",function(d,i){return x(d.date)}).attr("cy",function(d){return y(d.design)}).attr("fill","transparent").attr("class","design-circle").on("mouseover",function(d,i){updateLegendVal(d)}).on("mouseout",function(d){revertLegendValToToday()})}if(!this.hideActual&&actualData.length){if(this.chartType==="line"){svg.append("path").data([actualData]).attr("class","actual-area actual-line").style("stroke",this.axisConfig.y.series.actual.color).style("stroke-dasharray",this.axisConfig.y.series.actual.dashArray||"0,0").style("fill","transparent").attr("d",actualLine).style("pointer-events","none")}else{svg.append("path").datum(actualData).attr("class","actual-area").style("fill",this.axisConfig.y.series.actual.color).attr("d",actualArea).style("pointer-events","none")}svg.selectAll(".dot").data(actualData).enter().append("circle").attr("r",defaultDotRadius).attr("cx",function(d,i){return x(d.date)}).attr("cy",function(d){return y(d.actual)}).attr("fill",this.axisConfig.y.series.actual.color).attr("class","actual-circle").on("mouseover",function(d,i){d3.select(this).attr("r",defaultDotRadius+3);d.msg=tooltipTimeFormat(d.date)+"<br>"+"Actual of <b>"+d.actual+"</b><br>"+"produced in "+tooltipTimeFormat2(d.date);updateLegendVal(d);toolTip.show(d)}).on("mouseout",function(d){d3.select(this).attr("r",defaultDotRadius);revertLegendValToToday();toolTip.hide(d)})}if(!this.hideForecast&&forecastData.length>0){if(this.chartType==="line"){}else{var areaAboveForecastLine=d3.area().x(forecastLine.x()).y0(forecastLine.y()).y1(yScaledMin);var areaBelowForecastLine=d3.area().x(forecastLine.x()).y0(forecastLine.y()).y1(actualArea.y());var areaAboveActual=d3.area().x(actualArea.x()).y0(actualArea.y()).y1(yScaledMin);var areaBelowActual=d3.area().x(actualArea.x()).y0(actualArea.y()).y1(forecastLine.y());var defs=svg.append("defs");defs.append("clipPath").attr("id","clip-forecast").append("path").datum(forecastData).attr("class","forecast-area forecast-positive").attr("d",areaAboveForecastLine).style("pointer-events","none");defs.append("clipPath").attr("id","clip-actual").append("path").datum(forecastData).attr("class","forecast-area forecast-negative").attr("d",areaAboveActual).style("pointer-events","none");svg.append("path").datum(forecastData).attr("d",areaBelowForecastLine).attr("class","forecast-area forecast-negative").attr("clip-path","url(#clip-actual)").style("pointer-events","none");svg.append("path").datum(forecastData).attr("d",areaBelowActual).attr("class","forecast-area forecast-positive").attr("clip-path","url(#clip-forecast)").style("pointer-events","none")}}if(!this.hideTarget&&targetData.length){svg.append("path").data([targetData]).attr("class","target-line").style("stroke",this.axisConfig.y.series.target.color).style("stroke-dasharray",this.axisConfig.y.series.target.dashArray||"0,0").attr("d",targetChart).style("pointer-events","none");svg.selectAll(".dot").data(targetData).enter().append("circle").attr("r",defaultDotRadius).attr("cx",function(d,i){return x(d.date)}).attr("cy",function(d){return y(d.target)}).attr("fill",this.axisConfig.y.series.target.color).attr("class","target-circle").on("mouseover",function(d,i){d3.select(this).attr("r",defaultDotRadius+3);d.msg=tooltipTimeFormat(d.date)+"<br>"+"Target of <b>"+d.target+"</b><br>"+"produced in "+tooltipTimeFormat2(d.date);updateLegendVal(d);toolTip.show(d)}).on("mouseout",function(d){d3.select(this).attr("r",defaultDotRadius);revertLegendValToToday();toolTip.hide(d)})}if(!this.hideForecast&&forecastData.length){svg.append("path").datum(forecastData).attr("class","forecast-line").style("stroke-dasharray",this.axisConfig.y.series.forecast.dashArray||"0,0").attr("d",forecastLine);svg.selectAll(".dot").data(forecastData).enter().append("circle").attr("r",defaultDotRadius).attr("cx",function(d,i){return x(d.date)}).attr("cy",function(d){return y(d.forecast)}).attr("fill",this.axisConfig.y.series.forecast.color).attr("class","forecast-circle").on("mouseover",function(d,i){d3.select(this).attr("r",defaultDotRadius+3);d.msg=tooltipTimeFormat(d.date)+"<br>"+"Forecast of <b>"+d.forecast+"</b><br>"+"produced in "+tooltipTimeFormat2(d.date);updateLegendVal(d);toolTip.show(d)}).on("mouseout",function(d){d3.select(this).attr("r",defaultDotRadius);revertLegendValToToday();toolTip.hide(d)})}// Add the X Axis
var _xAxis=d3.axisBottom(x);if(this.axisConfig.x.tickTimeFormat){_xAxis.tickFormat(d3.timeFormat(this.axisConfig.x.tickTimeFormat||"%d %b %y"))}svg.append("g").attr("transform","translate(0,"+height+")").attr("class","x-axis").call(_xAxis);if(!this.axisConfig.y.hideGrid){svg.append("g").attr("class","y-grid").call(d3.axisLeft(y).ticks(5).tickSize(-width).tickFormat(""))}// Add the Y Axis
var _yAxis=d3.axisLeft(y).ticks(6);if(this.axisConfig.y.tickFormat){_yAxis.tickFormat(d3.format(this.axisConfig.y.tickFormat))}svg.append("g").attr("class","y-axis").call(_yAxis);svg.append("svg:line").attr("class","today").attr("x1",x(today)).attr("y1",height+18).attr("x2",x(today)).attr("y2",-7);svg.append("text").attr("class","today-text").attr("x",(x(x.domain()[0])+x(today))/2).attr("y",-9).text(this.axisConfig.x.historicalLabel||"Historical");svg.append("text").attr("class","today-text").attr("x",x(today)-10).attr("y",-9).text(this.axisConfig.x.todayLabel||"Today");if(!this.hideForecast&&forecastData.length>0){svg.append("text").attr("class","today-text").attr("x",x(x.domain()[1])*0.8).attr("y",-9).text(this.axisConfig.x.forecastLabel||"Forecast")}svg.append("text").attr("transform","rotate(-90)").attr("y",0-margin.left).attr("x",0-height/2).attr("dy","1em").attr("class","yaxis-label").text(this.unit);this.fire("chart-drawn",{})},_toggleActual:function _toggleActual(){this.hideActual=!this.hideActual;if(this.hideActual){this.querySelector(".actual-area").style.display="none";this.querySelectorAll(".actual-circle").forEach(function(elt){elt.style.display="none"})}else{this.querySelector(".actual-area").style.display="block";this.querySelectorAll(".actual-circle").forEach(function(elt){elt.style.display="block"})}},_toggleTarget:function _toggleTarget(){this.hideTarget=!this.hideTarget;if(this.hideTarget){this.querySelector(".target-line").style.display="none";this.querySelectorAll(".target-circle").forEach(function(elt){elt.style.display="none"})}else{this.querySelector(".target-line").style.display="block";this.querySelectorAll(".target-circle").forEach(function(elt){elt.style.display="block"})}},_toggleForecast:function _toggleForecast(){this.hideForecast=!this.hideForecast;if(this.hideForecast){this.querySelector(".forecast-line").style.display="none";this.querySelectorAll(".forecast-circle").forEach(function(elt){elt.style.display="none"});this.querySelectorAll(".forecast-area").forEach(function(elt){elt.style.display="none"})}else{this.querySelector(".forecast-line").style.display="block";this.querySelectorAll(".forecast-circle").forEach(function(elt){elt.style.display="block"});this.querySelectorAll(".forecast-area").forEach(function(elt){elt.style.display="block"})}},_redraw:function _redraw(newData,oldData){Polymer.dom(this.$.chart).node.innerHTML="";this.draw()},_setLegendLabels:function _setLegendLabels(labels){if(labels&&labels.length){this.set("actualLegendLabel",labels[0]);this.set("targetLegendLabel",labels[1]);this.set("forecastLegendLabel",labels[2]);this.set("designCapacityLegendLabel",labels[3])}},_compute:function _compute(prop){return prop}})})();
//# sourceMappingURL=production-chart.js.map
